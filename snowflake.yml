definition_version: '2'

# =============================================================================
# ML Layer Snowpark Build Configuration
# =============================================================================
# 
# This file is used by `snow snowpark build` to create the app.zip artifact.
#
# IMPORTANT: The procedure definitions below are for BUILD purposes only.
# Actual stored procedures and tasks are created via SQL files in setup/{project}/
# which provides more control (custom packages, tasks, EXECUTE AS OWNER).
#
# Usage:
#   snow snowpark build --ignore-anaconda    # Build app.zip
#
# Deployment is handled by:
#   - Local:  ./scripts/deploy.sh <project> <target>
#   - CI/CD:  .github/workflows/deploy-{project}.yml
# =============================================================================

env:
  target: PROD

entities:
  # ---------------------------------------------------------------------------
  # PLTV Build Configuration
  # NOTE: Procedure is created via setup/pltv/tasks.sql, not this definition
  # ---------------------------------------------------------------------------
  pltv_build:
    type: procedure
    identifier:
      name: PLTV_RUN
      schema: <% ctx.env.target %>
      database: ML_LAYER_PLTV_DB
    stage: ML_LAYER_PLTV_DB.<% ctx.env.target %>.ML_LAYER_STAGE
    artifacts:
      - src: app/
        dest: app/
    handler: projects.pltv.sproc.run_sproc
    signature: ''
    returns: string
    runtime: '3.10'
    execute_as_caller: false
